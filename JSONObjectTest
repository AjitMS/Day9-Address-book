package com.crisil.row.aop.logging;


import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import org.json.simple.parser.ParseException;

import java.io.File;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

// POJO - Plain Old Java Objects
public class Friend {

    private long id;

    private String firstName;

    private String lastName;

    private String nickName;

    private int noOfPosts;

    private int noOfFriends;

    // Association - has-a relationship
    private List<Post> post;

    // default constructor is gifted to us - hence, not created

    @Override
    public String toString() {
        return "Friend{" +
            "id=" + id +
            ", firstName='" + firstName + '\'' +
            ", lastName='" + lastName + '\'' +
            ", nickName='" + nickName + '\'' +
            ", noOfPosts=" + noOfPosts +
            ", noOfFriends=" + noOfFriends +
            '}';
    }

    public List<Post> getPost() {
        return post;
    }

    public void setPost(List<Post> post) {
        this.post = post;
    }

    public long getId() {
        return id;
    }

    public void setId(long id) {
        this.id = id;
    }

    public String getFirstName() {
        return firstName;
    }

    public void setFirstName(String firstName) {
        this.firstName = firstName;
    }

    public String getLastName() {
        return lastName;
    }

    public void setLastName(String lastName) {
        this.lastName = lastName;
    }

    public String getNickName() {
        return nickName;
    }

    public void setNickName(String nickName) {
        this.nickName = nickName;
    }

    public int getNoOfPosts() {
        return noOfPosts;
    }

    public void setNoOfPosts(int noOfPosts) {
        this.noOfPosts = noOfPosts;
    }

    public int getNoOfFriends() {
        return noOfFriends;
    }

    public void setNoOfFriends(int noOfFriends) {
        this.noOfFriends = noOfFriends;
    }

    public static void main(String[] args) throws IOException, ParseException {
        System.out.println(" **********Serialization Start********** ");
        Friend ajit = new Friend();

        ajit.setFirstName("Ajit");
        ajit.setLastName("Shikalgar");
        ajit.setNickName("");
        ajit.setNoOfFriends(700);
        ajit.setNoOfPosts(12);

        Post ajitsPost = new Post();
        ajitsPost.setId(121);
        ajitsPost.setContent(" Today I won 1st prize ");
        ajitsPost.setVisibleToPublic(true);

        Post ajitsPost2 = new Post();
        ajitsPost.setId(122);
        ajitsPost.setContent(" Today I won Nobel prize ");
        ajitsPost.setVisibleToPublic(false);

        List<Post> listOfAllPosts = new ArrayList<>();
        listOfAllPosts.add(ajitsPost);
        listOfAllPosts.add(ajitsPost2);
        ajit.setPost(listOfAllPosts);


        JSONArray allPostsJsonArray = new JSONArray();

        for(int i = 0; i< listOfAllPosts.size(); i++) {
            JSONObject ajitsPostJsonObject = new JSONObject();
            ajitsPostJsonObject.put("id", listOfAllPosts.get(i).getId());
            ajitsPostJsonObject.put("content", listOfAllPosts.get(i).getContent());
            ajitsPostJsonObject.put("visibleToPublic", listOfAllPosts.get(i).isVisibleToPublic());
            allPostsJsonArray.add(ajitsPostJsonObject);
        }



        // convert this Java object into JSON
        JSONObject ajitJsonObject = new JSONObject();
        ajitJsonObject.put("id", ajit.getId());
        ajitJsonObject.put("firstName", ajit.getFirstName());
        ajitJsonObject.put("lastName", ajit.getLastName());
        ajitJsonObject.put("nickName", ajit.getNickName());
        ajitJsonObject.put("noOfPosts", ajit.getNoOfPosts());
        ajitJsonObject.put("noOfFriends", ajit.getNoOfFriends());
        ajitJsonObject.put("post", allPostsJsonArray);


        System.out.println("Java Object " + ajit);
        System.out.println("JSON Object " + ajitJsonObject);

        System.out.println(" Starting File writing ");
        File file = new File("fb-friends.json");
        file.createNewFile();
        FileWriter fw = new FileWriter(file);
        fw.write(ajitJsonObject.toString());
        fw.flush();
        fw.close();
        System.out.println(" Completed File writing ");
        System.out.println(" **********Serialization Start********** ");

//        System.out.println(" **********De-Serialization Start********** ");
//        JSONParser jsonParser = new JSONParser();
//        Object rawObject = jsonParser.parse(new FileReader("friend.json"));
//        JSONObject loadedJsonObject = (JSONObject) rawObject;
//        Long noOfPosts = (Long) loadedJsonObject.get("noOfPosts");
//        System.out.println(" noOfPosts \t "+noOfPosts);
//        System.out.println(" Resulted JSON Object is \n "+loadedJsonObject);

    }
}
